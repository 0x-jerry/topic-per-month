import{b as n}from"./app.d30f2db1.js";import{D as s,o as t,c as a,a as e,e as o,m as l,s as c}from"./vendor.446251b2.js";const p={class:"markdown-body"},u=e("p",null,[e("div",{class:"table-of-contents"},[e("ul",null,[e("li",null,[e("a",{href:"#vscode-%E7%9A%84%E6%95%88%E6%9E%9C"}," VSCode 的效果")]),e("li",null,[e("a",{href:"#%E7%8C%9C%E6%83%B3%E4%BB%A5%E5%8F%8A%E5%B0%9D%E8%AF%95"}," 猜想以及尝试")]),e("li",null,[e("a",{href:"#%E8%A7%A3%E5%AF%86-vscode-%E7%9A%84%E5%81%9A%E6%B3%95"}," 解密 VSCode 的做法")]),e("li",null,[e("a",{href:"#%E7%BB%93%E8%AF%AD"}," 结语")])])])],-1),r=e("p",null,"本文主要探索， VSCode 是如何把 1w+ 行代码呈现出来，且做到滚动不卡顿的。",-1),i=e("p",null,"前不久，一同事与我探讨怎么解决渲染大列表的问题。第一个就想到虚拟列表，但是效果不是特别理想。随后想到 VSCode 在滚动大文件（约 1w 多行代码）的时候，很丝滑。随后便研究了一下。特此记录。",-1),k={id:"vscode-%E7%9A%84%E6%95%88%E6%9E%9C",tabindex:"-1"},b=c("#"),d=c(" VSCode 的效果"),m=e("p",null,"用 VSCode 随便打开一个 1w+ 的文件，最初加载的时间，会稍微多一点点。但是之后的滚动，却能做到没有丝毫的白屏。无论是滚动还是拖动，效果都非常的丝滑，简直就像是吃过德芙一样。",-1),h={id:"%E7%8C%9C%E6%83%B3%E4%BB%A5%E5%8F%8A%E5%B0%9D%E8%AF%95",tabindex:"-1"},f=c("#"),w=c(" 猜想以及尝试"),v=e("p",null,"看到这个效果，的第一想法：VSCode 肯定用了虚拟列表，不然 1w+ 的 dom 节点，仅是渲染，都会让页面卡的不行。",-1),y=c("为了验证这个想法，直接找了一个几个 "),g=e("code",null,"star",-1),E=c(" 较高的虚拟列表库，尝试用了用。例如 "),L=c("react-virtualized"),_=c(" 、"),C=c("vue-virtual-scroll-list"),A=c("、"),S=c("ngx-virtual-scroller"),R=c("。"),B=e("p",null,"这三个都很优秀，但是在快速滚动的时候，都还是会出现一点点白屏的间隙。",-1),D=e("p",null,"效果都不是特别理想。看来 VSCode 的做法估计还有点不一样。只有啃啃 VSCode 的源代码才接揭晓答案了。",-1),V={id:"%E8%A7%A3%E5%AF%86-vscode-%E7%9A%84%E5%81%9A%E6%B3%95",tabindex:"-1"},x=c("#"),N=c(" 解密 VSCode 的做法"),F=e("p",null,"打开 VSCode 的调试工具，看看具体的渲染效果，如下图：",-1),z=e("p",null,[e("img",{src:"/topic-per-month/assets/vscode-render-lines.9e74c493.png",alt:"vscode render lines"})],-1),j=e("p",null,[c("可以看出，的确是利用虚拟列表的技术，仅渲染了可视区域的代码。且是利用 "),e("code",null,"css"),c(" 的 "),e("code",null,"top"),c(" 值来确定每一行代码的相对坐标。")],-1),q=e("p",null,[e("strong",null,"那么它是怎么做到，快速滚动不白屏的呢？")],-1),W=e("p",null,"带着这个疑问，先试试自己去实现一个虚拟列表，差不多也是依葫芦画瓢，效果不是特别理想。快速滚动的时候也会出现白屏。",-1),M=e("p",null,[c("粗略分析一下，猜测原因是出在监听 "),e("code",null,"scroll"),c(" 事件上。因为 "),e("code",null,"scroll"),c(" 事件是在滚动时触发的。")],-1),T=c("The "),H=e("strong",null,"scroll",-1),U=c(" event fires when the document view has been scrolled. — "),O=c("MDN"),P=e("p",null,[c("因此，为了验证这个猜想，把 "),e("code",null,"scroll"),c(" 事件，换成 "),e("code",null,"wheel"),c(" 事件。注：这样的做法并不严谨，但是为了验证猜想足以。")],-1),I=e("p",null,[c("换成 "),e("code",null,"wheel"),c(" 之后，结果稍稍好了一点点，但是快速滚动依旧是有白屏。看来还是不对。")],-1),G=e("p",null,"这下就越来越对 VSCode 的做法感兴趣了，那么，是时候展现 VSCode 的技术了。",-1),J=c("经过不断的啃代码，总算找到渲染每一行代码的源代码了。 "),K=c("source: viewLines.ts"),Q=e("div",{class:"language-ts line-numbers-mode"},[e("div",{class:"highlight-lines"},[e("br"),e("div",{class:"highlighted"}," "),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("br"),e("div",{class:"highlighted"}," "),e("div",{class:"highlighted"}," "),e("br"),e("br")]),e("pre",null,[e("code",{"v-pre":""},[c("\t"),e("span",{class:"token keyword"},"public"),c(),e("span",{class:"token function"},"renderText"),e("span",{class:"token punctuation"},"("),c("viewportData"),e("span",{class:"token operator"},":"),c(" ViewportData"),e("span",{class:"token punctuation"},")"),e("span",{class:"token operator"},":"),c(),e("span",{class:"token keyword"},"void"),c(),e("span",{class:"token punctuation"},"{"),c("\n\t\t"),e("span",{class:"token comment"},"// (1) render lines - ensures lines are in the DOM"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_visibleLines"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"renderLines"),e("span",{class:"token punctuation"},"("),c("viewportData"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_lastRenderedData"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setCurrentVisibleRange"),e("span",{class:"token punctuation"},"("),c("viewportData"),e("span",{class:"token punctuation"},"."),c("visibleRange"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("domNode"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setWidth"),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_context"),e("span",{class:"token punctuation"},"."),c("viewLayout"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"getScrollWidth"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("domNode"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setHeight"),e("span",{class:"token punctuation"},"("),c("Math"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"min"),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_context"),e("span",{class:"token punctuation"},"."),c("viewLayout"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"getScrollHeight"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},","),c(),e("span",{class:"token number"},"1000000"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\n\t\t"),e("span",{class:"token comment"},"// (2) compute horizontal scroll position:"),c("\n\t\t"),e("span",{class:"token comment"},"//  - this must happen after the lines are in the DOM since it might need a line that rendered just now"),c("\n\t\t"),e("span",{class:"token comment"},"//  - it might change `scrollWidth` and `scrollLeft`"),c("\n\t\t"),e("span",{class:"token keyword"},"if"),c(),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_horizontalRevealRequest"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\n\t\t\t"),e("span",{class:"token keyword"},"const"),c(" horizontalRevealRequest "),e("span",{class:"token operator"},"="),c(),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_horizontalRevealRequest"),e("span",{class:"token punctuation"},";"),c("\n\n\t\t\t"),e("span",{class:"token comment"},"// Check that we have the line that contains the horizontal range in the viewport"),c("\n\t\t\t"),e("span",{class:"token keyword"},"if"),c(),e("span",{class:"token punctuation"},"("),c("viewportData"),e("span",{class:"token punctuation"},"."),c("startLineNumber "),e("span",{class:"token operator"},"<="),c(" horizontalRevealRequest"),e("span",{class:"token punctuation"},"."),c("minLineNumber "),e("span",{class:"token operator"},"&&"),c(" horizontalRevealRequest"),e("span",{class:"token punctuation"},"."),c("maxLineNumber "),e("span",{class:"token operator"},"<="),c(" viewportData"),e("span",{class:"token punctuation"},"."),c("endLineNumber"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\n\t\t\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_horizontalRevealRequest "),e("span",{class:"token operator"},"="),c(),e("span",{class:"token keyword"},"null"),e("span",{class:"token punctuation"},";"),c("\n\n\t\t\t\t"),e("span",{class:"token comment"},"// allow `visibleRangesForRange2` to work"),c("\n\t\t\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"onDidRender"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\n\t\t\t\t"),e("span",{class:"token comment"},"// compute new scroll position"),c("\n\t\t\t\t"),e("span",{class:"token keyword"},"const"),c(" newScrollLeft "),e("span",{class:"token operator"},"="),c(),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"_computeScrollLeftToReveal"),e("span",{class:"token punctuation"},"("),c("horizontalRevealRequest"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\n\t\t\t\t"),e("span",{class:"token keyword"},"if"),c(),e("span",{class:"token punctuation"},"("),c("newScrollLeft"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\t\t\t\t\t"),e("span",{class:"token keyword"},"if"),c(),e("span",{class:"token punctuation"},"("),e("span",{class:"token operator"},"!"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_isViewportWrapping"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\t\t\t\t\t\t"),e("span",{class:"token comment"},"// ensure `scrollWidth` is large enough"),c("\n\t\t\t\t\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"_ensureMaxLineWidth"),e("span",{class:"token punctuation"},"("),c("newScrollLeft"),e("span",{class:"token punctuation"},"."),c("maxHorizontalOffset"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t\t\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\t\t\t\t\t"),e("span",{class:"token comment"},"// set `scrollLeft`"),c("\n\t\t\t\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_context"),e("span",{class:"token punctuation"},"."),c("model"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setScrollPosition"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"{"),c("\n\t\t\t\t\t\tscrollLeft"),e("span",{class:"token operator"},":"),c(" newScrollLeft"),e("span",{class:"token punctuation"},"."),c("scrollLeft\n\t\t\t\t\t"),e("span",{class:"token punctuation"},"}"),e("span",{class:"token punctuation"},","),c(" horizontalRevealRequest"),e("span",{class:"token punctuation"},"."),c("scrollType"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\t\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\n\t\t"),e("span",{class:"token comment"},"// Update max line width (not so important, it is just so the horizontal scrollbar doesn't get too small)"),c("\n\t\t"),e("span",{class:"token keyword"},"if"),c(),e("span",{class:"token punctuation"},"("),e("span",{class:"token operator"},"!"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"_updateLineWidthsFast"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\t\t\t"),e("span",{class:"token comment"},"// Computing the width of some lines would be slow => delay it"),c("\n\t\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_asyncUpdateLineWidths"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"schedule"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\n\t\t"),e("span",{class:"token keyword"},"if"),c(),e("span",{class:"token punctuation"},"("),c("platform"),e("span",{class:"token punctuation"},"."),c("isLinux "),e("span",{class:"token operator"},"&&"),c(),e("span",{class:"token operator"},"!"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_asyncCheckMonospaceFontAssumptions"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"isScheduled"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\t\t\t"),e("span",{class:"token keyword"},"const"),c(" rendStartLineNumber "),e("span",{class:"token operator"},"="),c(),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_visibleLines"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"getStartLineNumber"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t\t"),e("span",{class:"token keyword"},"const"),c(" rendEndLineNumber "),e("span",{class:"token operator"},"="),c(),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_visibleLines"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"getEndLineNumber"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t\t"),e("span",{class:"token keyword"},"for"),c(),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"let"),c(" lineNumber "),e("span",{class:"token operator"},"="),c(" rendStartLineNumber"),e("span",{class:"token punctuation"},";"),c(" lineNumber "),e("span",{class:"token operator"},"<="),c(" rendEndLineNumber"),e("span",{class:"token punctuation"},";"),c(" lineNumber"),e("span",{class:"token operator"},"++"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\t\t\t\t"),e("span",{class:"token keyword"},"const"),c(" visibleLine "),e("span",{class:"token operator"},"="),c(),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_visibleLines"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"getVisibleLine"),e("span",{class:"token punctuation"},"("),c("lineNumber"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t\t\t"),e("span",{class:"token keyword"},"if"),c(),e("span",{class:"token punctuation"},"("),c("visibleLine"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"needsMonospaceFontCheck"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token punctuation"},"{"),c("\n\t\t\t\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_asyncCheckMonospaceFontAssumptions"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"schedule"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t\t\t\t"),e("span",{class:"token keyword"},"break"),e("span",{class:"token punctuation"},";"),c("\n\t\t\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\t\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\t\t"),e("span",{class:"token punctuation"},"}"),c("\n\n\t\t"),e("span",{class:"token comment"},"// (3) handle scrolling"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_linesContent"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setLayerHinting"),e("span",{class:"token punctuation"},"("),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_canUseLayerHinting"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_linesContent"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setContain"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'strict'"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token keyword"},"const"),c(" adjustedScrollTop "),e("span",{class:"token operator"},"="),c(),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_context"),e("span",{class:"token punctuation"},"."),c("viewLayout"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"getCurrentScrollTop"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),c(),e("span",{class:"token operator"},"-"),c(" viewportData"),e("span",{class:"token punctuation"},"."),c("bigNumbersDelta"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_linesContent"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setTop"),e("span",{class:"token punctuation"},"("),e("span",{class:"token operator"},"-"),c("adjustedScrollTop"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t\t"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_linesContent"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"setLeft"),e("span",{class:"token punctuation"},"("),e("span",{class:"token operator"},"-"),e("span",{class:"token keyword"},"this"),e("span",{class:"token punctuation"},"."),c("_context"),e("span",{class:"token punctuation"},"."),c("viewLayout"),e("span",{class:"token punctuation"},"."),e("span",{class:"token function"},"getCurrentScrollLeft"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},";"),c("\n\t"),e("span",{class:"token punctuation"},"}"),c("\n")])]),e("div",{class:"line-numbers-wrapper"},[e("span",{class:"line-number"},"1"),e("br"),e("span",{class:"line-number"},"2"),e("br"),e("span",{class:"line-number"},"3"),e("br"),e("span",{class:"line-number"},"4"),e("br"),e("span",{class:"line-number"},"5"),e("br"),e("span",{class:"line-number"},"6"),e("br"),e("span",{class:"line-number"},"7"),e("br"),e("span",{class:"line-number"},"8"),e("br"),e("span",{class:"line-number"},"9"),e("br"),e("span",{class:"line-number"},"10"),e("br"),e("span",{class:"line-number"},"11"),e("br"),e("span",{class:"line-number"},"12"),e("br"),e("span",{class:"line-number"},"13"),e("br"),e("span",{class:"line-number"},"14"),e("br"),e("span",{class:"line-number"},"15"),e("br"),e("span",{class:"line-number"},"16"),e("br"),e("span",{class:"line-number"},"17"),e("br"),e("span",{class:"line-number"},"18"),e("br"),e("span",{class:"line-number"},"19"),e("br"),e("span",{class:"line-number"},"20"),e("br"),e("span",{class:"line-number"},"21"),e("br"),e("span",{class:"line-number"},"22"),e("br"),e("span",{class:"line-number"},"23"),e("br"),e("span",{class:"line-number"},"24"),e("br"),e("span",{class:"line-number"},"25"),e("br"),e("span",{class:"line-number"},"26"),e("br"),e("span",{class:"line-number"},"27"),e("br"),e("span",{class:"line-number"},"28"),e("br"),e("span",{class:"line-number"},"29"),e("br"),e("span",{class:"line-number"},"30"),e("br"),e("span",{class:"line-number"},"31"),e("br"),e("span",{class:"line-number"},"32"),e("br"),e("span",{class:"line-number"},"33"),e("br"),e("span",{class:"line-number"},"34"),e("br"),e("span",{class:"line-number"},"35"),e("br"),e("span",{class:"line-number"},"36"),e("br"),e("span",{class:"line-number"},"37"),e("br"),e("span",{class:"line-number"},"38"),e("br"),e("span",{class:"line-number"},"39"),e("br"),e("span",{class:"line-number"},"40"),e("br"),e("span",{class:"line-number"},"41"),e("br"),e("span",{class:"line-number"},"42"),e("br"),e("span",{class:"line-number"},"43"),e("br"),e("span",{class:"line-number"},"44"),e("br"),e("span",{class:"line-number"},"45"),e("br"),e("span",{class:"line-number"},"46"),e("br"),e("span",{class:"line-number"},"47"),e("br"),e("span",{class:"line-number"},"48"),e("br"),e("span",{class:"line-number"},"49"),e("br"),e("span",{class:"line-number"},"50"),e("br"),e("span",{class:"line-number"},"51"),e("br"),e("span",{class:"line-number"},"52"),e("br"),e("span",{class:"line-number"},"53"),e("br"),e("span",{class:"line-number"},"54"),e("br"),e("span",{class:"line-number"},"55"),e("br"),e("span",{class:"line-number"},"56"),e("br"),e("span",{class:"line-number"},"57"),e("br"),e("span",{class:"line-number"},"58"),e("br"),e("span",{class:"line-number"},"59"),e("br"),e("span",{class:"line-number"},"60"),e("br"),e("span",{class:"line-number"},"61"),e("br"),e("span",{class:"line-number"},"62"),e("br"),e("span",{class:"line-number"},"63"),e("br")])],-1),X=e("p",null,[c("从源代码可看出，其做法是确保在 "),e("code",null,"dom"),c(" 渲染完成之后，再更新滚动条。那么按照这个想法，就需要捕获所有可能的滚动操作，然后在更新滚动值之前，确保 "),e("code",null,"dom"),c(" 渲染完成。")],-1),Y=e("p",null,"从理论上来讲，这样的确能有效的防止白屏。",-1),Z=c("光讲理论怎么行呢，还是要试一下才行。尝试用这个方式，写了一个 "),$=c("demo: test-vscode-render-lines"),nn=c("，仅实现捕获 "),sn=e("code",null,"wheel",-1),tn=c(" 事件，效果还不错，无论滚动多快，都没有出现白屏。"),an={id:"%E7%BB%93%E8%AF%AD",tabindex:"-1"},en=c("#"),on=c(" 结语"),ln=e("p",null,[c("至此，这次探究告一段论。目前仅尝试在固定每一行高度时，去计算出现在可视区域的 "),e("code",null,"dom"),c(" 元素，这样能在几乎 1 ms 之内完成。那么，问题来了。如果高度不是固定的，是可变的怎么办呢？计算时间会不会增加，如果列表元素太复杂了，渲染时间增加了，会不会出现滚动卡顿的情况？这些都还是需要测试。")],-1),cn=e("p",null,"目前看来，这种做法，在列表元素较少且高度固定时，表现比普通的虚拟列表好。除此之外的情况，或许还是普通的虚拟列表更优吧，这个就等之后再去探索了。",-1),pn={setup(c,{expose:pn}){pn({frontmatter:{title:"VSCode 如何渲染代码",tags:["vscode","js","virtual-list","performance"],meta:[{property:"og:title",content:"VSCode 如何渲染代码"}]}});return s({title:"VSCode 如何渲染代码",meta:[{property:"og:title",content:"VSCode 如何渲染代码"}]}),(s,c)=>{const pn=n;return t(),a("div",p,[u,r,i,e("h2",k,[o(pn,{class:"header-anchor",href:"#vscode-%E7%9A%84%E6%95%88%E6%9E%9C","aria-hidden":"true"},{default:l((()=>[b])),_:1}),d]),m,e("h2",h,[o(pn,{class:"header-anchor",href:"#%E7%8C%9C%E6%83%B3%E4%BB%A5%E5%8F%8A%E5%B0%9D%E8%AF%95","aria-hidden":"true"},{default:l((()=>[f])),_:1}),w]),v,e("p",null,[y,g,E,o(pn,{href:"https://bvaughn.github.io/react-virtualized/#/components/List",target:"_blank",rel:"noopener noreferrer"},{default:l((()=>[L])),_:1}),_,o(pn,{href:"https://tangbc.github.io/vue-virtual-scroll-list/#/keep-state",target:"_blank",rel:"noopener noreferrer"},{default:l((()=>[C])),_:1}),A,o(pn,{href:"https://rintoj.github.io/ngx-virtual-scroller/demo",target:"_blank",rel:"noopener noreferrer"},{default:l((()=>[S])),_:1}),R]),B,D,e("h2",V,[o(pn,{class:"header-anchor",href:"#%E8%A7%A3%E5%AF%86-vscode-%E7%9A%84%E5%81%9A%E6%B3%95","aria-hidden":"true"},{default:l((()=>[x])),_:1}),N]),F,z,j,q,W,M,e("blockquote",null,[e("p",null,[T,H,U,o(pn,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Document/scroll_event",target:"_blank",rel:"noopener noreferrer"},{default:l((()=>[O])),_:1})])]),P,I,G,e("p",null,[J,o(pn,{href:"https://github.com/microsoft/vscode/blob/aa93eefe550167de3ca29aaa3d06f721a47594a3/src/vs/editor/browser/viewParts/lines/viewLines.ts#L559-L621",target:"_blank",rel:"noopener noreferrer"},{default:l((()=>[K])),_:1})]),Q,X,Y,e("p",null,[Z,o(pn,{href:"https://0x-jerry.github.io/test-vscode-render-lines/",target:"_blank",rel:"noopener noreferrer"},{default:l((()=>[$])),_:1}),nn,sn,tn]),e("h2",an,[o(pn,{class:"header-anchor",href:"#%E7%BB%93%E8%AF%AD","aria-hidden":"true"},{default:l((()=>[en])),_:1}),on]),ln,cn])}}};export{pn as default};
